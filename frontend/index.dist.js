function a(r,t){if(typeof r!="string")throw TypeError("selector is not a string");let e=document.querySelector(r);if(e==null)throw Error(`can't found a element for "${r}"`);if(e instanceof t)return e;throw Error(`"${r}" is not a ${t.name}`)}function d(r,t=void 0){let e=document.createElement(r);if(typeof t=="string")e.textContent=t;else if(t!=null&&typeof t=="object"&&(t.text&&(e.textContent=t.text),t.classes&&e.classList.add(...t.classes),t.fn&&(t.fn(e),t.fn=void 0),t.children&&e.append(...t.children),t.style))for(let[n,s]of Object.entries(t.style))n in e.style?e.style.key=s:e.style.setProperty(n,s);return e}var pt=class extends Event{constructor(t){super("emit"),this.value=t}},Rt=class extends EventTarget{constructor({frequency:t,signal:e}){super(),this._frequency=t,this._enabled=!1,this._fractionStep=0,this._prevTime=-1,this._rafID=0;let n=s=>{if(this._enabled&&this._prevTime!==-1){let i=s-this._prevTime,o=this._fractionStep;this._fractionStep+=i/1e3*this._frequency;let c=Math.floor(this._fractionStep)-Math.floor(o);this.dispatchEvent(new pt(c))}this._prevTime=s,this._rafID=requestAnimationFrame(n)};this._rafID=requestAnimationFrame(n),e!==void 0&&e.addEventListener("abort",()=>{this.abort()})}abort(){this._rafID!==0&&cancelAnimationFrame(this._rafID)}get frequency(){return this._frequency}set frequency(t){this._frequency=t}get disabled(){return!this._enabled}set disabled(t){this._enabled=!t}enable(){this._enabled=!0}disable(){this._enabled=!1}reset(){this._fractionStep=0}};function se(r){return r instanceof Error?r.message:"Unknown error is occurred."}function*Ge(r,t,{exact:e=!1}={}){if(!Number.isInteger(t))throw RangeError("size is not an integer");if(t<=0)throw RangeError("size is less than 1");let n=[];for(let s of r)n.push(s),t<=n.length&&(yield n,n=[]);e&&n.length!==t||n.length!==0&&(yield n)}function Ve(){let r=document.createElement("span");return r.classList.add("spinner-border","spinner-border-sm"),r.setAttribute("role","status"),r.setAttribute("aria-hidden","true"),r}var l=class{pretty(){return"unimplemented"}extractUnaryRegisterNumbers(){return[]}extractBinaryRegisterNumbers(){return[]}extractLegacyTRegisterNumbers(){return[]}doesReturnValue(){return!1}isSameComponent(t){return!0}};var q=0,F=1,X=2,K=3,B=4,C=5,D=6,Bt="INC",ie="TDEC",Ct="READ",Dt="SET",oe="B2DX",ae="B2DY",ce="B2D",tn="DEC",Ye="SQX",qe="SQY",Fe="SQ";function Ze(r){switch(r){case Bt:return q;case ie:return F;case Ct:return X;case Dt:return K}}function en(r){switch(r){case q:return Bt;case F:return ie;case X:return Ct;case K:return Dt}}function je(r){switch(r){case oe:return B;case ae:return C;case ce:return D}}function rn(r){switch(r){case B:return oe;case C:return ae;case D:return ce}}var S=class extends l{constructor(t,e){super(),this.op=t,this.axis=e}pretty(){return`${en(this.op)} ${rn(this.axis)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)){if(n===Bt||n===ie){if(s===oe||s===ae)return new S(Ze(n),je(s))}else if((n===Ct||n===Dt)&&s===ce)return new S(Ze(n),je(s));switch(n){case Bt:switch(s){case Ye:return new S(q,B);case qe:return new S(q,C);default:return}case tn:switch(s){case Ye:return new S(F,B);case qe:return new S(F,C);default:return}case Ct:switch(s){case Fe:return new S(X,D);default:return}case Dt:switch(s){case Fe:return new S(K,D);default:return}}}}doesReturnValue(){switch(this.op){case q:return!1;case F:return!0;case X:return!0;case K:return!1}}isSameComponent(t){return t instanceof S?this.axis===B&&t.axis===C?!1:!(this.axis===C&&t.axis===B):!1}};function ue(r,t){let e=[];for(let n=0;n<r;n++)e.push(t(n));return e}var At=class{constructor(t=0,e=0){if(t<0||e<0)throw RangeError("B2D constructor: negative");this.x=t,this.y=e,this.maxX=t,this.maxY=e,this.array=ue(this.maxY+1,()=>ue(this.maxX+1,()=>0))}getArray(){return this.array}getMaxX(){return this.maxX}getMaxY(){return this.maxY}action(t){switch(t.op){case q:{switch(t.axis){case B:return this.incB2DX();case C:return this.incB2DY();case D:throw Error("B2D: internal")}break}case F:{switch(t.axis){case B:return this.tdecB2DX();case C:return this.tdecB2DY();case D:throw Error("B2D: internal")}break}case X:{switch(t.axis){case D:return this.read();default:throw Error("B2D: internal")}break}case K:{switch(t.axis){case D:return this.set();default:throw Error("B2D: internal")}break}default:throw Error("B2D: internal")}}incB2DX(){if(this.x++,this.maxX<this.x){for(let t of this.array)t.push(0);this.maxX=this.x}}incB2DY(){this.y++,this.maxY<this.y&&(this.array.push(ue(this.maxX+1,()=>0)),this.maxY=this.y)}tdecB2DX(){return this.x===0?0:(this.x--,1)}tdecB2DY(){return this.y===0?0:(this.y--,1)}read(){let t=this.array[this.y];if(t===void 0)throw Error("B2D: internal error");let e=t[this.x];if(e===void 0)throw Error("B2D: internal error");return t[this.x]=0,e}set(){let t=this.array[this.y];if(t===void 0)throw Error("B2D: internal error");if(t[this.x]===1)throw Error(`SET B2D: Tried to set when it was already 1. x = ${this.x}, y = ${this.y}.`);t[this.x]=1}toString(){return this.array.map(t=>t.join("")).join(`
`)}};function Pe(r,t,e,n){let s=r.canvas.width,i=r.canvas.height;s!==i&&(r.canvas.height=s),r.clearRect(0,0,s,s),r.resetTransform(),r.beginPath();let o=t.getMaxX(),c=t.getMaxY(),p=Math.max(o,c)+1,u=s/p;n&&(r.scale(1,-1),r.translate(0,-s));let f=t.getArray();r.fillStyle="#212529";for(let g=0;g<=c;g++){let _=f[g];if(_===void 0)throw Error("renderB2D: internal error");let W=g*u;for(let G=0;G<=o;G++)_[G]===1&&r.rect(G*u,W,u,u)}r.fill(),e||(r.strokeStyle="#03A9F4",r.lineWidth=4,r.strokeRect(t.x*u,t.y*u,u,u))}var Z=0,A=1,pe="INC",fe="TDEC",We="U",nn="R";function sn(r){switch(r){case Z:return pe;case A:return fe}}function on(r){switch(r){case pe:return Z;case fe:return A}}var b=class extends l{constructor(t,e){super(),this.op=t,this.regNumber=e,this.registerCache=void 0}extractUnaryRegisterNumbers(){return[this.regNumber]}pretty(){return`${sn(this.op)} ${We}${this.regNumber}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)&&(n===pe||n===fe)&&(s.startsWith(We)||s.startsWith(nn))){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new b(on(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case Z:return!1;case A:return!0}}isSameComponent(t){return t instanceof b?this.regNumber===t.regNumber:!1}};var Lt=class{constructor(){this.value=0}action(t){switch(t.op){case A:return this.value===0?0:(this.value--,1);case Z:this.value++}}actionN(t,e){switch(t.op){case A:{this.value-=e;break}case Z:{this.value+=e;break}}}getValue(){return this.value}setValue(t){this.value=t}inc(){this.action(new b(Z,0))}tdec(){let t=this.action(new b(A,0));if(t===void 0)throw Error("internal error");return t}setByRegistersInit(t,e){(typeof e!="number"||e<0||!Number.isInteger(e))&&an(t,e),this.setValue(e)}};function an(r,t){let e=`"${r}": ${JSON.stringify(t)}`;throw Error(`Invalid #REGISTERS ${e}`)}function cn(r){if(window.innerWidth<768)return 8+1===r?r:8;let e=12;return e+1<=r&&r<=e+2?r:e}function un(r){return d("th",`U${r}`)}function pn(r,t){return d("td",{text:t.getValue().toString(),fn:e=>{e.dataset.test=`U${r}`}})}function fn(r){let t=[],e=[],n=cn(r.size);for(let i of Ge(r.entries(),n)){let o=document.createElement("tr"),c=document.createElement("tr");for(let[p,u]of i){o.appendChild(un(p));let f=pn(p,u);t.push(f),c.appendChild(f)}e.push({header:o,data:c})}let s=document.createElement("table");for(let i of e)s.append(i.header,i.data);return s.classList.add("table"),s.style.tableLayout="fixed",s.style.marginBottom="0",{table:s,cells:t}}var Mt=class{constructor(t){this.root=t,this.cells=[]}initialize(t){let{table:e,cells:n}=fn(t);this.root.innerHTML="",this.root.appendChild(e),this.cells=n}clear(){this.cells=[],this.root.innerHTML=""}render(t){let e=0,n=this.cells;for(let s of t.values()){let i=n[e];if(i===void 0)throw Error("renderUnary: internal error");i.textContent=s.getValue().toString(),e++}}};var L=0,M=1,J=2,Q=3,de="INC",le="TDEC",he="READ",me="SET",Xe="B";function dn(r){switch(r){case L:return de;case M:return le;case J:return he;case Q:return me}}function ln(r){switch(r){case de:return L;case le:return M;case he:return J;case me:return Q}}var h=class extends l{constructor(t,e){super(),this.op=t,this.regNumber=e,this.registerCache=void 0}extractBinaryRegisterNumbers(){return[this.regNumber]}pretty(){return`${dn(this.op)} ${Xe}${this.regNumber}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)&&(n===de||n===le||n===he||n===me)&&s.startsWith(Xe)){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new h(ln(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case L:return!1;case M:return!0;case J:return!0;case Q:return!1}}isSameComponent(t){return t instanceof h?this.regNumber===t.regNumber:!1}};function Ke(r){return[...r].map(t=>{if(t==="0")return 0;if(t==="1")return 1;throw Error(`Invalid #REGISTERS: "${r}"`)})}var hn=typeof BigInt<"u";function tt(){throw Error("internal error")}var kt=class{constructor(){this.pointer=0,this.bits=[0]}action(t){switch(t.op){case M:return this.pointer===0?0:(this.pointer--,1);case L:{this.pointer++;let e=this.bits;this.pointer===e.length&&e.push(0);break}case J:{let e=this.pointer,n=this.bits;if(e<n.length){let s=n[e]??tt();return n[e]=0,s}else return 0}case Q:{let e=this.bits,n=this.pointer;if(n>=e.length&&this.extend(),e[n]===1)throw Error(`The bit of the binary register B${t.regNumber} is already 1`);e[n]=1;break}default:throw Error("BReg action: "+t.op)}}actionN(t,e){switch(t.op){case L:{this.pointer+=e,this.extend();break}case M:{this.pointer-=e;break}default:throw Error("todo")}}getBits(){return this.bits}setBits(t){this.bits=t}inc(){let t=this.action(new h(L,0));return t!==void 0&&tt(),t}tdec(){let t=this.action(new h(M,0));return t===void 0&&tt(),t}read(){let t=this.action(new h(J,0));return t===void 0&&tt(),t}set(){let t=this.action(new h(Q,0));return t!==void 0&&tt(),t}extend(){let t=this.pointer,e=this.bits.length;if(t>=e)if(t===e)this.bits.push(0);else{let n=Array(t-e+1).fill(0).map(()=>0);this.bits=this.bits.concat(n)}}toBinaryString(){return this.bits.slice().reverse().join("")}toString(t=10){let e="0b"+this.toBinaryString();return hn?BigInt(e).toString(t):Number(e).toString(t)}toDecimalString(){return this.toString()}toHexString(){return this.toString(16)}toObject(){return this.extend(),{prefix:this.bits.slice(0,this.pointer),head:this.bits[this.pointer]??tt(),suffix:this.bits.slice(this.pointer+1)}}setByRegistersInit(t,e){let n=i=>{throw Error(`Invalid #REGISTERS ${i}`)},s=`"${t}": ${JSON.stringify(e)}`;if(typeof e=="number")this.setBits(Ke(e.toString(2)).reverse()),this.extend();else if(!Array.isArray(e)||e.length!==2)n(s);else{let i=e[0],o=e[1];typeof i!="number"||typeof o!="string"||i<0||!Number.isInteger(i)?n(s):(this.pointer=i,this.setBits(Ke(o)),this.extend())}}};function mn(){throw Error("error")}function gn(){let r=d("span",{classes:["decimal"]}),t=d("span",{classes:["hex"]}),e=d("span",{classes:["pointer"]});return{metaData:d("code",{classes:["binary_info","word-break-all"],children:[r,t,e]}),$decimal:r,$hex:t,$pointer:e}}function bn(){let r=d("span",{classes:["prefix"]}),t=d("span",{classes:["binary-head"]}),e=d("span",{classes:["suffix"]});return{binaryBits:d("code",{classes:["word-break-all"],children:[r,t,e]}),$prefix:r,$head:t,$suffix:e}}var Ut=class{constructor(t){this.root=t,this.cells=[]}initialize(t){let e=[],n=d("table");for(let s of t.keys()){let i=d("td");i.dataset.test=`B${s}`;let{metaData:o,$decimal:c,$hex:p,$pointer:u}=gn();i.append(o,d("br"));let{binaryBits:f,$prefix:g,$head:_,$suffix:W}=bn();i.append(f);let G=d("tr",{children:[d("th",`B${s}`),i]});n.append(G),e.push({$decimal:c,$hex:p,$pointer:u,$prefix:g,$head:_,$suffix:W})}this.root.innerHTML="",this.root.append(n),this.cells=e}clear(){this.cells=[],this.root.innerHTML=""}render(t,e,n,s,i){let o=0,c=this.cells;for(let p of t.values()){let{$prefix:u,$head:f,$suffix:g,$decimal:_,$hex:W,$pointer:G}=c[o]??mn();if(e)u.innerHTML="",f.innerHTML="",g.innerHTML="";else if(n){let Y=p.toObject();u.textContent=Y.suffix.reverse().join(""),f.textContent=Y.head.toString(),g.textContent=Y.prefix.reverse().join("")}else{let Y=p.toObject();u.textContent=Y.prefix.join(""),f.textContent=Y.head.toString(),g.textContent=Y.suffix.join("")}s?_.textContent="value = "+p.toDecimalString()+", ":_.innerHTML="",i?W.textContent="hex = "+p.toHexString()+", ":W.innerHTML="",G.textContent="pointer = "+p.pointer.toString(),o++}}};var Je="stats_current_state";function xn(r,{z:t,nz:e}){let n=d("td",{fn:u=>{u.colSpan=2},children:[d("code",r)]}),s="num",i=d("td",{text:(t+e).toLocaleString(),classes:[s]}),o=d("td",{text:t.toLocaleString(),classes:[s]}),c=d("td",{text:e.toLocaleString(),classes:[s]});return{$tr:d("tr",{children:[n,i,o,c]}),$sum:i,$z:o,$nz:c}}var Ht=class{constructor(t,e){this.root=t,this.statsNumberOfStates=e,this.cells=[]}initialize(t,e){this.statsNumberOfStates.textContent=e.length.toLocaleString(),this.cells=[],this.root.innerHTML="";for(let[n,s]of t.entries()){let i=e[n]??"",{$tr:o,$sum:c,$z:p,$nz:u}=xn(i,s);this.root.append(o),this.cells.push({$sum:c,$z:p,$nz:u,$tr:o})}}clear(){this.statsNumberOfStates.innerHTML="",this.cells=[],this.root.innerHTML=""}render(t,e){let n=t,s=this.cells,i=s.length;for(let o=0;o<i;o++){let c=s[o]??Qe();e===o?c.$tr.classList.add(Je):c.$tr.classList.remove(Je);let{z:p,nz:u}=n[o]??Qe();c.$sum.textContent=(p+u).toLocaleString(),c.$z.textContent=p.toLocaleString(),c.$nz.textContent=u.toLocaleString()}}};function Qe(){throw Error("error")}function tr(r,t){if(r.innerHTML="",t===void 0)return;let e=document.createElement("option");e.textContent="None",e.value="-1",e.selected=!0,r.append(e);for(let[n,s]of t.getStateMap().entries()){let i=document.createElement("option");i.textContent=n,i.value=s.toString(),r.append(i)}}function er(r){let t=r.value;return t==="any"?-1:t==="zero"?0:1}var yn="Start",Sn="Stop",rr="btn-primary",nr="btn-danger";function En(){let r=document.createElement("div");return r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play" viewBox="0 0 16 16">
        <path stroke="currentColor" stroke-width="0.8" d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>
    </svg> ${yn}`,r}var wn=En();function Tn(){let r=document.createElement("div");return r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stop" viewBox="0 0 16 16">
        <path stroke="currentColor" stroke-width="0.8" d="M3.5 5A1.5 1.5 0 0 1 5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5zM5 4.5a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5V5a.5.5 0 0 0-.5-.5H5z"/>
    </svg> ${Sn}`,r}var vn=Tn();function ft(r){for(r.disabled=!1;r.hasChildNodes();)r.firstChild?.remove();r.append(wn),r.classList.add(rr),r.classList.remove(nr)}function sr(r){for(r.disabled=!1;r.hasChildNodes();)r.firstChild?.remove();r.append(vn),r.classList.remove(rr),r.classList.add(nr)}function ir(r,t,e){if(t==="RuntimeError"||t==="ParseError"){let n=e.split(`
`);r.innerHTML="";for(let s of n)r.append(d("span","- "+s),d("br"));r.classList.remove("d-none")}else r.classList.add("d-none")}function or(r,t){if(t=t??"",r.value===t)return;r.value=t;let n=t.length,i=Math.min(6,Math.max(1,Math.ceil(n/40)));r.rows=i}function ar(r){return r===void 0?"":`
    ADD = ${r.add.toStringDetail()},
    SUB = ${r.sub.toStringDetail()},
    MUL = ${r.mul.toString()}
    `}function $n(){let r=[];for(let e=0;e<=6;e++){let n=10**e;for(let s=1;s<=9;s++)r.push(n*s)}return r.push(...[10,15].map(e=>e*10**6)),r}function _n(){throw Error("error")}function cr(r,t){let e=$n();r.min="0",r.max=(e.length-1).toString(),r.addEventListener("input",()=>{let n=parseInt(r.value,10),s=e[n]??_n();r.ariaValueText=`(${s.toString()}Hz)`,t.setFrequency(s),t.renderFrequencyOutput()})}function ur(r,t){r.setCustomValidity(t),r.reportValidity(),r.classList.add("is-invalid")}function pr(r){r.setCustomValidity(""),r.reportValidity(),r.classList.remove("is-invalid")}function fr(r,t){r.addEventListener("input",()=>{let e=r.files===null?void 0:r.files[0];e!==void 0&&e.text().then(t)})}function dr(){let r=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(r!=null&&typeof r=="object")return r.saveData}var dt=window.requestIdleCallback??(r=>{setTimeout(()=>{r({didTimeout:!1,timeRemaining(){return 0}})},0)});function lr(r){r instanceof URL&&(r=r.href);let t=document.createElement("link");t.rel="prefetch",t.href=r,document.head.append(t)}function lt(r,t){try{localStorage.setItem(r,t)}catch{}}var In=new Set(["textarea","input","summary","details","button","audio","video","select","option","a","area"]);function hr(){let r=document.activeElement?.tagName.toLowerCase()??"";return In.has(r)}var mr=a("#error",HTMLElement),T=a("#input",HTMLTextAreaElement),gr=a("#output",HTMLTextAreaElement),br=a("#steps",HTMLElement),$=a("#toggle",HTMLButtonElement),k=a("#reset",HTMLButtonElement),v=a("#step",HTMLButtonElement),xr=a("#config_button",HTMLButtonElement),et=a("#stats_button",HTMLButtonElement),yr=a("#current_state",HTMLElement),Sr=a("#previous_output",HTMLElement),Er=a("#frequency_input",HTMLInputElement),wr=a("#frequency_output",HTMLElement),Tr=a("#command",HTMLElement),Ot=a("#canvas",HTMLCanvasElement),zt=Ot.getContext("2d")??(()=>{throw Error("context is null")})(),ht={x:a("#b2dx",HTMLElement),y:a("#b2dy",HTMLElement)},mt=a("#b2d_detail",HTMLDetailsElement),vr=a("#unary_register",HTMLElement),Gt=a("#unary_register_detail",HTMLDetailsElement),$r=a("#binary_register",HTMLElement),Vt=a("#binary_register_detail",HTMLDetailsElement),_r=a("#add_sub_mul",HTMLElement),Ir=a("#import_file",HTMLInputElement),Yt=a("#examples",HTMLButtonElement),ge=document.querySelectorAll(".js_example"),be=a("#config_modal_content",HTMLElement),gt=a("#step_input",HTMLInputElement),E={$hideBinary:a("#hide_binary",HTMLInputElement),$reverseBinary:a("#reverse_binary",HTMLInputElement),$showBinaryValueInDecimal:a("#show_binary_value_in_decimal",HTMLInputElement),$showBinaryValueInHex:a("#show_binary_value_in_hex",HTMLInputElement)},xe=a("#breakpoint_select",HTMLSelectElement),Nr=a("#breakpoint_input_select",HTMLSelectElement),rt=a("#dark_mode",HTMLInputElement),ye=rt.parentElement?.querySelector("label")??(()=>{throw Error("label of #dark_mode is not found")})(),qt=a("#b2d_hide_pointer",HTMLInputElement),bt=a("#b2d_flip_upside_down",HTMLInputElement),Ft=a("#stats_modal",HTMLElement),Rr=a("#stats_body",HTMLTableSectionElement),Br=a("#stats_number_of_states",HTMLElement),Cr=a("#view-state-diagram",HTMLButtonElement);var nt=0,st=1,it=2,Se="A1",Ee="B0",we="B1",Dr="ADD";function Nn(r){switch(r){case nt:return Se;case st:return Ee;case it:return we}}function Rn(r){switch(r){case Se:return nt;case Ee:return st;case we:return it}}var w=class extends l{constructor(t){super(),this.op=t}pretty(){return`${Dr} ${Nn(this.op)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===Dr&&(s===Se||s===Ee||s===we))return new w(Rn(s))}doesReturnValue(){switch(this.op){case nt:return!1;case st:return!0;case it:return!0}}isSameComponent(t){return t instanceof w}};var Ar="HALT_OUT",y=class extends l{constructor(){super()}pretty(){return Ar}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==1)return;let[n]=e;if(n===Ar)return new y}doesReturnValue(){return!1}isSameComponent(t){return t instanceof y}};var Zt=0,jt=1,Te="0",ve="1",Lr="MUL";function Bn(r){switch(r){case Te:return Zt;case ve:return jt}}function Cn(r){switch(r){case Zt:return Te;case jt:return ve}}var U=class extends l{constructor(t){super(),this.op=t}pretty(){return`${Lr} ${Cn(this.op)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===Lr&&(s===Te||s===ve))return new U(Bn(s))}doesReturnValue(){return!0}isSameComponent(t){return t instanceof U}};var I=class extends l{constructor(){super()}pretty(){return"NOP"}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==1)return;let[n]=e;if(n==="NOP")return new I}doesReturnValue(){return!0}isSameComponent(t){return t instanceof I}};var Mr="OUTPUT",H=class extends l{constructor(t){super(),this.digit=t}pretty(){return`${Mr} ${this.digit}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===Mr&&s!==void 0)return new H(s)}doesReturnValue(){return!1}isSameComponent(t){return t instanceof H}};var xt=0,yt=1,St=2,$e="A1",_e="B0",Ie="B1",kr="SUB";function Dn(r){switch(r){case xt:return $e;case yt:return _e;case St:return Ie}}function An(r){switch(r){case $e:return xt;case _e:return yt;case Ie:return St}}var O=class extends l{constructor(t){super(),this.op=t}pretty(){return`${kr} ${Dn(this.op)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===kr&&(s===$e||s===_e||s===Ie))return new O(An(s))}doesReturnValue(){switch(this.op){case xt:return!1;case yt:return!0;case St:return!0}}isSameComponent(t){return t instanceof O}};var Et=0,wt=1,Tt=2,vt=3,$t=4,Ne="INC",Re="DEC",Be="READ",Ce="SET",De="RESET";function Ln(r){switch(r){case Et:return Ne;case wt:return Re;case Tt:return Be;case vt:return Ce;case $t:return De}}function Mn(r){switch(r){case Ne:return Et;case Re:return wt;case Be:return Tt;case Ce:return vt;case De:return $t}}var z=class extends l{constructor(t,e){super(),this.op=t,this.regNumber=e}extractLegacyTRegisterNumbers(){return[this.regNumber]}pretty(){return`${Ln(this.op)} T${this.regNumber}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)&&(n===Ne||n===Re||n===Be||n===Ce||n===De)&&s.startsWith("T")){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new z(Mn(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case Et:return!0;case wt:return!0;case Tt:return!0;case vt:return!1;case $t:return!1}}isSameComponent(t){return t instanceof z?this.regNumber===t.regNumber:!1}};var Pt=class{constructor(){this.value=0}action(t){switch(t.op){case st:{let e=this.value,n=e%2;return this.value=[0,0,0,0,0,0,9,9,0,0,9,9,9,9,9,9][e]??this.error(),n}case it:{let e=this.value,n=1-e%2;return this.value=[0,0,0,0,9,9,0,0,9,9,0,0,9,9,9,9][e]??this.error(),n}case nt:{this.value=[5,4,7,6,1,0,3,2,13,12,15,14,9,8,11,10][this.value]??this.error();return}default:throw Error("ADD action: internal")}}getValue(){return this.value}a1(){this.action(new w(nt))}b0(){let t=this.action(new w(st));return t===void 0&&this.error(),t}b1(){let t=this.action(new w(it));return t===void 0&&this.error(),t}error(){throw Error("ADD: internal")}toString(){return this.value.toString(2).padStart(4,"0")}toStringDetail(){let t=this.toString();return`${t.slice(0,3)} bit${t.slice(3)}`}};var Wt=class{constructor(){this.value=0}action(t){switch(t.op){case Zt:return this.mul0();case jt:return this.mul1();default:throw Error("MUL: action")}}getValue(){return this.value}mul0(){let t=this.value%2;return this.value=this.value>>1,t}mul1(){let t=this.value%2;return this.value<=21?this.value=(this.value>>1)+5:this.value=this.value-22>>1,t}toString(){return this.value.toString(2).padStart(5,"0")}};var Xt=class{constructor(){}action(){return 0}};var Kt=class{constructor(){this.string=""}action(t){this.output(t.digit)}getString(){return this.string}output(t){this.string+=t}};var Jt=class{constructor(){this.value=0}action(t){switch(t.op){case yt:return this.b0();case xt:return this.a1();case St:return this.b1();default:throw Error("SUB: action error")}}getValue(){return this.value}a1(){let e=[3,2,-1,-1,7,6,-1,-1,11,10,-1,-1,15,14,-1,-1,19,18,-1,-1,23,22,-1,-1,27,26,-1,-1,31,30,-1,-1][this.value]??this.error();if(e===-1)throw Error("SUB error: A1");this.value=e}b0(){let t=this.value%2,e=[0,0,0,0,17,17,0,0,0,0,0,0,0,0,17,17,17,17,0,0,17,17,17,17,0,0,17,17,17,17,17,17];return this.value=e[this.value]??this.error(),t}b1(){let t=1-this.value%2,e=[17,17,0,0,0,0,0,0,0,0,17,17,0,0,0,0,17,17,17,17,17,17,0,0,17,17,17,17,0,0,17,17];return this.value=e[this.value]??this.error(),t}toString(){return this.value.toString(2).padStart(5,"0")}toStringDetail(){let t=this.toString();return t.slice(0,3)+" stopper"+t.slice(3,4)+" bit"+t.slice(4)}error(){throw Error("SUB: internal error")}};var Qt=class{constructor(){this.pointer=0,this.bits=[0]}action(t){switch(t.op){case Et:return this.inc();case Tt:return this.read();case wt:return this.dec();case vt:return this.set();case $t:return this.reset();default:throw Error(`LegacyTReg action: ${t.op}`)}}getPointer(){return this.pointer}getBits(){return this.bits}inc(){return this.pointer===this.bits.length-1?(this.bits.push(0),this.pointer++,0):(this.pointer++,1)}dec(){return this.pointer===0?0:(this.pointer--,1)}read(){let t=this.bits[this.pointer];if(t===0)return this.bits[this.pointer]=-1,0;if(t===1)return this.bits[this.pointer]=-1,1;throw Error(t===-1?"Error: reading empty space of T register":"internal error")}set(){if(this.bits[this.pointer]===-1)this.bits[this.pointer]=1;else throw Error("Error: SET to nonempty bit")}reset(){if(this.bits[this.pointer]===-1)this.bits[this.pointer]=0;else throw Error("Error: RESET to nonempty bit")}};function _t(r,t){throw new Error(`Register ${r}${t} is not found.`)}var te=class{constructor({unaryRegisterNumbers:t,binaryRegisterNumbers:e,legacyTRegisterNumbers:n}){this.unaryRegisterNumbers=t,this.binaryRegisterNumbers=e,this.uRegMap=new Map(this.unaryRegisterNumbers.map(s=>[s,new Lt])),this.bRegMap=new Map(this.binaryRegisterNumbers.map(s=>[s,new kt])),this.legecyTRegMap=new Map(n.map(s=>[s,new Qt])),this.add=new Pt,this.sub=new Jt,this.mul=new Wt,this.b2d=new At,this.output=new Kt,this.nop=new Xt}setByRegistersInit(t){for(let[e,n]of Object.entries(t))this.setKeyValue(e,n)}setKeyValue(t,e){if(t.startsWith("U")){let n=parseInt(t.slice(1),10);isNaN(n)&&Ae(t,e);let s=this.getUReg(n);if(s===void 0)throw Error(`Invalid #REGISTERS: U${n} isn't used in the program`);s.setByRegistersInit(t,e)}else if(t.startsWith("B")){let n=parseInt(t.slice(1),10);isNaN(n)&&Ae(t,e);let s=this.getBReg(n);if(s===void 0)throw Error(`Invalid #REGISTERS: B${n} isn't used in the program`);s.setByRegistersInit(t,e)}else Ae(t,e)}execAction(t){if(t instanceof h)return(t.registerCache??this.bRegMap.get(t.regNumber)??_t("B",t.regNumber)).action(t);if(t instanceof b)return(t.registerCache??this.uRegMap.get(t.regNumber)??_t("U",t.regNumber)).action(t);if(t instanceof w)return this.add.action(t);if(t instanceof I)return this.nop.action();if(t instanceof O)return this.sub.action(t);if(t instanceof U)return this.mul.action(t);if(t instanceof S)return this.b2d.action(t);if(t instanceof H)return this.output.action(t);if(t instanceof y)return-1;if(t instanceof z)return(this.legecyTRegMap.get(t.regNumber)??_t("T",t.regNumber)).action(t);throw Error(`execAction: unknown action ${t.pretty()}`)}execActionN(t,e){if(t instanceof b)return(t.registerCache??this.uRegMap.get(t.regNumber)??_t("U",t.regNumber)).actionN(t,e);if(t instanceof h)return(t.registerCache??this.bRegMap.get(t.regNumber)??_t("B",t.regNumber)).actionN(t,e);if(t instanceof y)return-1;throw Error(`execActionN: todo ${t.pretty()}`)}getUReg(t){return this.uRegMap.get(t)}getBReg(t){return this.bRegMap.get(t)}};function Ae(r,t){let e=`"${r}": ${JSON.stringify(t)}`;throw Error(`Invalid #REGISTERS ${e}`)}function Le(r){let t=[h.parse,b.parse,S.parse,I.parse,w.parse,U.parse,O.parse,H.parse,y.parse,z.parse];for(let e of t){let n=e(r);if(n!==void 0)return n}}var It="INITIAL",j=class{pretty(){return"unimplemented"}},N=class extends j{constructor(t){super(),this.content=t}static get key(){return"#COMPONENTS"}pretty(){return N.key+" "+this.content}},R=class extends j{constructor(t){super(),this.content=t}static get key(){return"#REGISTERS"}pretty(){return R.key+" "+this.content}},Me=class extends j{constructor(t){super(),this.str=t}getString(){return this.str}pretty(){return this.getString()}},ke=class extends j{constructor(){super()}pretty(){return""}};function kn(r){switch(r){case"Z":return r;case"NZ":return r;case"ZZ":return r;case"*":return r;default:return}}var at=class extends j{constructor({state:t,input:e,nextState:n,actions:s,line:i}){super(),this.state=t,this.input=e,this.nextState=n,this.actions=s,this.line=i,this._string=`${this.state}; ${this.input}; ${this.nextState}; ${this.actions.map(o=>o.pretty()).join(", ")}`}pretty(){return this._string}};function ee(){throw Error("internal error")}function Ur(r,t=void 0){if(typeof r!="string")throw TypeError("str is not a string");let e=r.trim();if(e==="")return new ke;if(e.startsWith("#"))return e.startsWith(N.key)?new N(e.slice(N.key.length).trim()):e.startsWith(R.key)?new R(e.slice(R.key.length).trim()):new Me(r);let n=e.split(/\s*;\s*/u);if(n.length<4)return`Invalid line "${r}"${ot(t)}`;if(n.length>4)return n[4]===""?`Extraneous semicolon "${r}"${ot(t)}`:`Invalid line "${r}"${ot(t)}`;let s=n[0]??ee(),i=n[1]??ee(),o=n[2]??ee(),p=(n[3]??ee()).trim().split(/\s*,\s*/u).filter(g=>g!==""),u=[];for(let g of p){let _=Le(g);if(_===void 0)return`Unknown action "${g}" in "${r}"${ot(t)}`;u.push(_)}let f=kn(i);return f===void 0?`Unknown input "${i}" in "${r}"${ot(t)}. Expect "Z", "NZ", "ZZ", or "*"`:new at({state:s,input:f,nextState:o,actions:u,line:t})}function ot(r){return r!=null?` at line ${r}`:""}function x(r){return ot(r.line)}function Hr(r){if(r.actions.some(e=>e instanceof y))return;let t=r.actions.filter(e=>e.doesReturnValue());if(t.length!==1)return t.length===0?`Does not produce the return value in "${r.pretty()}"${x(r)}`:`Does not contain exactly one action that produces a return value in "${r.pretty()}": Actions that produce value are ${t.map(e=>`"${e.pretty()}"`).join(", ")}${x(r)}`}function Or(r){if(r.nextState===It)return`Return to initial state in "${r.pretty()}"${x(r)}`}function zr(r){if(r.actions.length<=1)return;let t=r.actions.map(e=>e.pretty());t.sort();for(let e=0;e<t.length-1;e++){let n=t[e],s=t[e+1];if(n===s)return`Duplicated actions "${n}" in "${r.pretty()}"${x(r)}`}}function Gr(){throw Error("internal error")}function Vr(r){if(r.actions.find(n=>n instanceof y)!==void 0)return;let t=r.actions,e=t.length;if(!(e<=1))for(let n=0;n<e;n++)for(let s=n+1;s<e;s++){let i=t[n]??Gr(),o=t[s]??Gr();if(i.isSameComponent(o))return`Actions "${i.pretty()}" and "${o.pretty()}" use same component in "${r.pretty()}"${x(r)}`}}function Yr(){throw Error("internal error")}function Un(r,t){return r.line!==void 0&&t?.line!==void 0?` at line ${r.line} and ${t.line}`:""}function qr(r){let t=(s,i)=>`Need Z line followed by NZ line in "${s.pretty()}"${Un(s,i)}`,e=r.length-1;for(let s=0;s<e;s++){let i=r[s]??Yr(),o=r[s+1]??Yr();if(i.input==="Z"&&o.input!=="NZ")return[t(i,o)];if(o.input==="NZ"&&i.input!=="Z")return[t(i,o)];if(i.input==="Z"&&o.input==="NZ"&&i.state!==o.state)return[t(i,o)]}let n=r[r.length-1];if(n!==void 0&&n.input==="Z")return[t(n)]}var ct=class{constructor(t){this.array=t}getArray(){return this.array}pretty(){return this.getArray().map(t=>t.pretty()).join(`
`)}static parse(t){let n=t.split(/\r\n|\n|\r/u).map((o,c)=>Ur(o,c+1)),s=n.flatMap(o=>typeof o=="string"?[o]:[]);if(s.length>0)return s.join(`
`);let i=n.flatMap(o=>typeof o!="string"?[o]:[]);return new ct(i)}};function Fr(r){let t=[],e=[zr,Hr,Vr,Or];for(let s of r)for(let i of e){let o=i(s);typeof o=="string"&&t.push(o)}let n=[qr];for(let s of n){let i=s(r);Array.isArray(i)&&(t=t.concat(i))}if(t.length>0)return t.join(`
`)}var V=class{constructor({programLines:t}){this.commands=t.getArray().flatMap(e=>e instanceof at?[e]:[]),this.componentsHeader=void 0;for(let e of t.getArray())if(e instanceof N){if(this.componentsHeader!==void 0)throw Error(`Multiple ${N.key}`);this.componentsHeader=e}this.registersHeader=void 0;for(let e of t.getArray())if(e instanceof R){if(this.registersHeader!==void 0)throw new Error(`Multiple ${R.key}`);this.registersHeader=e}this.programLines=t}static parse(t){let e=ct.parse(t);if(typeof e=="string")return e;let n=[];for(let i of e.getArray())i instanceof at&&n.push(i);if(n.length===0)return"Program is empty";let s=Fr(n);if(typeof s=="string")return s;try{return new V({programLines:e})}catch(i){return i instanceof Error?i.message:"Unknown error is occurred."}}extractRegisterNumbers(){let t=this.commands.flatMap(e=>e.actions);return{unary:Ue(t.flatMap(e=>e.extractUnaryRegisterNumbers())),binary:Ue(t.flatMap(e=>e.extractBinaryRegisterNumbers())),legacyT:Ue(t.flatMap(e=>e.extractLegacyTRegisterNumbers()))}}pretty(){return this.programLines.pretty()}};function Ue(r){return[...new Set(r)].sort((t,e)=>t-e)}function Hn(r){return r instanceof h&&r.op===L}function On(r){return r instanceof b&&r.op===A}function zn(r){if(r.input==="NZ"&&r.state===r.nextState&&r.actions.every(t=>!(t instanceof y))&&r.actions.every(t=>t instanceof b||Hn(t))){let t=r.actions.find(On);if(t&&t instanceof b)return{tdecU:t}}}function Gn(r){if(r.input==="NZ"&&r.state===r.nextState&&r.actions.every(t=>!(t instanceof y))&&r.actions.length===1&&r.actions.every(t=>t instanceof h)){let t=r.actions.find(e=>e instanceof h&&e.op===M);if(t&&t instanceof h)return{tdecB:t}}}var ut=class{constructor(t,e){this.command=t,this.nextState=e,this.tdecuOptimize=zn(t),this.tdecbOptimize=Gn(t)}},Oe=class{constructor(t,e){this.z=t,this.nz=e}};function He(r,t){throw Error(`Duplicated command: "${r.pretty()}" and "${t.pretty()}"${x(t)}`)}function Zr(r){let t=new Map,e=[];function n(){throw Error("commandsToLookupTable internal error")}for(let s of r)if(!t.has(s.state)){let i=t.size;t.set(s.state,i),e.push(new Oe(void 0,void 0))}for(let s of r){let i=e[t.get(s.state)??n()]??n(),o=t.get(s.nextState);if(o===void 0)throw Error(`Unknown state: "${s.nextState}" at "${s.pretty()}"${x(s)}`);switch(s.input){case"Z":{i.z===void 0?i.z=new ut(s,o):He(i.z.command,s);break}case"NZ":{i.nz===void 0?i.nz=new ut(s,o):He(i.nz.command,s);break}case"ZZ":{if(i.nz!==void 0)throw Error(`Invalid input: ZZ with NZ or *: "${s.pretty()}" and "${i.nz.command.pretty()}"${x(s)}`);i.z===void 0?i.z=new ut(s,o):He(i.z.command,s);break}case"*":{if(i.nz!==void 0)throw Error(`Invalid input: * "${s.pretty()}" and "${i.nz.command.pretty()}"${x(s)}`);if(i.z!==void 0)throw Error(`Invalid input: * "${s.pretty()}" and "${i.z.command.pretty()}"${x(s)}`);{let c=new ut(s,o);i.z=c,i.nz=c}break}default:{let c=s.input;console.error(c),n()}}}return{states:[...t.keys()],stateMap:t,lookup:e}}function ze(r="error"){throw Error(r)}var P=class{constructor(t){if(!(t instanceof V))throw TypeError("program is not a Program");this.stepCount=0;let e=t.extractRegisterNumbers();this.actionExecutor=new te({binaryRegisterNumbers:e.binary,unaryRegisterNumbers:e.unary,legacyTRegisterNumbers:e.legacyT}),this.prevOutput=0,this.program=t;let n=Zr(t.commands);this.states=n.states,this.stateMap=n.stateMap,this.lookup=n.lookup;for(let i of n.lookup){let o=(i.z?.command.actions??[]).concat(i.nz?.command.actions??[]);for(let c of o)this.setCache(c)}this.currentStateIndex=this.stateMap.get(It)??ze(`${It} state is not present`),this.initialIndex=this.currentStateIndex,this.stateStatsArray=Array(this.lookup.length*2).fill(0).map(()=>0);let s=t.registersHeader;s!==void 0&&this.setByRegistersHeader(s)}static fromString(t){let e=V.parse(t);if(typeof e=="string")throw new Error(e);return new P(e)}getStateStats(){let t=[];for(let e=0;e<this.stateStatsArray.length;e+=2)t.push({z:this.stateStatsArray[e]??ze(),nz:this.stateStatsArray[e+1]??ze()});return t}setByRegistersHeader(t){let e=t.content.replace(/'/ug,'"'),n={};try{n=JSON.parse(e)}catch{throw Error(`Invalid #REGISTERS: is not a valid JSON: "${e}"`)}if(n===null||typeof n!="object")throw Error(`Invalid #REGISTERS: "${e}" is not an object`);this.actionExecutor.setByRegistersInit(n)}setCache(t){t instanceof h?t.registerCache=this.actionExecutor.getBReg(t.regNumber):t instanceof b&&(t.registerCache=this.actionExecutor.getUReg(t.regNumber))}getCurrentState(){let t=this.states[this.currentStateIndex];if(t===void 0)throw Error("State name is not found");return t}getStateMap(){return this.stateMap}getPreviousOutput(){return this.prevOutput===0?"Z":"NZ"}log(){let t=this.currentStateIndex,e=this.prevOutput;this.stateStatsArray[t*2+e]++}getNextCompiledCommandWithNextState(){let t=this.currentStateIndex,e=this.lookup[t];if(e===void 0)throw Error(`Internal Error: Next command is not found: Current state index: ${t}`);if(this.prevOutput===0){let s=e.z;if(s!==void 0)return s}else{let s=e.nz;if(s!==void 0)return s}throw Error("Next command is not found: Current state = "+this.getCurrentState()+", output = "+this.getPreviousOutput())}_internalExecActionN(t,e){try{let n=this.actionExecutor;for(let s of t.actions)n.execActionN(s,e)}catch(n){if(n instanceof Error)this.throwError(n);else throw n}this.stateStatsArray[this.currentStateIndex*2+this.prevOutput]+=e,this.stepCount+=e}exec(t,e,n,s){let i=n!==-1,o=performance.now();for(let c=0;c<t;c++){let p=this.getNextCompiledCommandWithNextState();if(p.tdecuOptimize){let f=p.tdecuOptimize.tdecU.registerCache?.getValue();if(f!==void 0&&f!==0){f=Math.min(f,t-c);let g=p.command;this._internalExecActionN(g,f),c+=f-1;continue}}else if(p.tdecbOptimize){let f=p.tdecbOptimize.tdecB.registerCache?.pointer;if(f!==void 0&&f!==0){f=Math.min(f,t-c);let g=p.command;this._internalExecActionN(g,f),c+=f-1;continue}}try{if(this.execCommandFor(p)===-1)return"Halted"}catch(u){if(u instanceof Error)this.throwError(u);else throw u}if(i&&this.currentStateIndex===n&&(s===-1||s===this.prevOutput))return"Stop";if(e&&(c+1)%5e5===0&&performance.now()-o>=50)return}}throwError(t){let e=this.getNextCompiledCommandWithNextState().command,n=x(e);throw new Error(t.message+` in "${e.pretty()}"`+n)}execCommandFor(t){this.stepCount+=1,this.log();let e=-1,n=this.actionExecutor;for(let i of t.command.actions){let o=n.execAction(i);if(o===-1)return-1;if(o!==void 0)if(e===-1)e=o;else throw Error(`Return value twice: line = ${t.command.pretty()}${x(t.command)}`)}if(e===-1)throw Error(`No return value: line = ${t.command.pretty()}${x(t.command)}`);let s=t.nextState;this.currentStateIndex=s,this.prevOutput=e}execCommand(){let t=this.getNextCompiledCommandWithNextState();return this.execCommandFor(t)}};var Vn=30,re=class{constructor(){this.machine=void 0,this.appState="Initial",this.prevAppState=void 0,this.errorMessage="",this.stepConfig=1,this.cve=new Rt({frequency:Vn});let t=this;this.cve.addEventListener("emit",function(n){n instanceof pt&&t.run(n.value)}),this.prevFrequency=void 0,this.unaryUI=new Mt(vr),this.binaryUI=new Ut($r),this.statsUI=new Ht(Rr,Br)}setFrequency(t){this.cve.frequency=t}initializeApp(){this.render()}start(){switch(this.appState){case"Initial":{this.reset(),this.appState==="Stop"&&(this.appState="Running");break}case"Stop":{this.appState="Running";break}default:throw Error("start: unreachable")}this.render()}stop(){this.appState="Stop",this.render()}setUpUnary(){this.machine===void 0?this.unaryUI.clear():this.unaryUI.initialize(this.machine.actionExecutor.uRegMap)}setUpBinary(){this.machine===void 0?this.binaryUI.clear():this.binaryUI.initialize(this.machine.actionExecutor.bRegMap)}onMachineSet(){this.setUpUnary(),this.setUpBinary(),this.setUpStats(),tr(xe,this.machine)}setInputAndReset(t){T.value=t,this.reset()}toggle(){this.appState==="Running"?this.stop():this.start()}doStep(){if(this.appState==="Running"&&this.stop(),this.stepConfig>=5e6){let t=Ve();v.append(t),v.disabled=!0,k.disabled=!0,$.disabled=!0,setTimeout(()=>{this.run(this.stepConfig),v.removeChild(t)},33)}else this.run(this.stepConfig)}reset(){this.errorMessage="",this.machine=void 0,this.cve.reset();try{this.machine=P.fromString(T.value),this.onMachineSet(),this.appState="Stop"}catch(t){this.appState="ParseError",this.errorMessage=se(t)}finally{this.render()}}renderFrequencyOutput(){let t=this.cve.frequency;this.prevFrequency!==t&&(wr.textContent=t.toLocaleString()),this.prevFrequency=t}renderCommand(){try{let t=this.machine?.getNextCompiledCommandWithNextState();Tr.textContent=t?.command.pretty()??""}catch(t){console.error(t)}}renderB2D(){if(!mt.open)return;let t=this.machine;if(t===void 0){ht.x.textContent="0",ht.y.textContent="0",zt.clearRect(0,0,Ot.width,Ot.height),zt.resetTransform();return}let e=t.actionExecutor.b2d;ht.x.textContent=e.x.toString(),ht.y.textContent=e.y.toString();let n=performance.now();Pe(zt,e,qt.checked,bt.checked),this.appState==="Running"&&performance.now()-n>=200&&(mt.open=!1)}renderUnary(){this.machine!==void 0&&Gt.open&&this.unaryUI.render(this.machine.actionExecutor.uRegMap)}renderBinary(){this.machine!==void 0&&Vt.open&&this.binaryUI.render(this.machine.actionExecutor.bRegMap,E.$hideBinary.checked,E.$reverseBinary.checked,E.$showBinaryValueInDecimal.checked,E.$showBinaryValueInHex.checked)}renderOutput(){let t=this.machine?.actionExecutor.output.getString();or(gr,t)}setUpStats(){this.machine===void 0?this.statsUI.clear():this.statsUI.initialize(this.machine.getStateStats(),this.machine.states)}renderStats(){if(!!Ft.classList.contains("show")){if(this.machine===void 0){this.statsUI.clear();return}this.statsUI.render(this.machine.getStateStats(),this.machine.currentStateIndex)}}renderButton(){switch(this.appState){case"Initial":{ft($),v.disabled=!1,k.disabled=!1,et.disabled=!0;break}case"Stop":{ft($),v.disabled=!1,k.disabled=!1,et.disabled=!1;break}case"Running":{sr($),v.disabled=!0,k.disabled=!0,et.disabled=!1;break}case"RuntimeError":case"ParseError":{ft($),$.disabled=!0,v.disabled=!0,k.disabled=!1,et.disabled=!0;break}case"Halted":{ft($),$.disabled=!0,v.disabled=!0,k.disabled=!1,et.disabled=!1;break}}}render(){this.cve.disabled=this.appState!=="Running",(this.prevAppState!==this.appState||this.appState==="Stop")&&(this.renderButton(),this.appState==="ParseError"?T.classList.add("is-invalid"):T.classList.remove("is-invalid")),ir(mr,this.appState,this.errorMessage),this.renderFrequencyOutput(),yr.textContent=this.machine?.getCurrentState()??"",Sr.textContent=this.machine?.getPreviousOutput()??"",br.textContent=this.machine?.stepCount.toLocaleString()??"",this.renderCommand(),this.renderOutput(),this.renderUnary(),this.renderBinary(),_r.textContent=ar(this.machine?.actionExecutor),this.renderB2D(),this.renderStats(),this.prevAppState=this.appState}run(t){switch(this.appState){case"Initial":if(this.reset(),this.appState!=="Stop")return}if(t<=0||Number.isNaN(t))return;let e=this.machine;if(e===void 0)return;let n=this.appState==="Running",s=parseInt(xe.value,10),i=er(Nr);try{let o=e.exec(t,n,s,i);o!==void 0&&(this.appState=o)}catch(o){this.appState="RuntimeError",this.errorMessage=se(o)}finally{this.render()}}};var jr="./frontend/data/",m=new re;k.addEventListener("click",()=>{m.reset()});$.addEventListener("click",()=>{m.toggle()});v.addEventListener("click",()=>{m.doStep()});var Pr="src";ge.forEach(r=>{r.addEventListener("click",async()=>{Yt.style.opacity="0.5";let t=r.dataset[Pr];try{let e=await fetch(jr+t);if(!e.ok)throw Error("error");m.setInputAndReset(await e.text()),T.scrollTop=0}catch{console.error(`Fetch Error: ${t}`)}finally{Yt.style.opacity="1"}})});cr(Er,m);mt.addEventListener("toggle",()=>{m.renderB2D()});Vt.addEventListener("toggle",()=>{m.renderBinary()});Gt.addEventListener("toggle",()=>{m.renderUnary()});fr(Ir,r=>{m.setInputAndReset(r),T.scrollTop=0});gt.addEventListener("input",()=>{let r=Number(gt.value);isNaN(r)||r<=0||!Number.isInteger(r)?(ur(gt,"Enter a positive integer"),m.stepConfig=1):(pr(gt),m.stepConfig=r)});function Nt(r,t){r.addEventListener("change",()=>{m.render(),lt(t,r.checked.toString())})}var Wr="hide_binary";Nt(E.$hideBinary,Wr);var Xr="reverse_binary";Nt(E.$reverseBinary,Xr);var ne="show_binary_in_decimal";Nt(E.$showBinaryValueInDecimal,ne);var Kr="show_binary_in_hex";Nt(E.$showBinaryValueInHex,Kr);qt.addEventListener("change",()=>{m.renderB2D()});var Jr="b2d_flip_upside_down";Nt(bt,Jr);Ft.addEventListener("shown.bs.modal",()=>{m.renderStats()});Cr.addEventListener("click",()=>{T.value.length>=10**6||(lt("state-diagram-input",T.value),window.open("./labs/diagram/index.html",void 0,"noreferrer=yes,noopener=yes"))});var Qr="dark_mode";rt.addEventListener("change",()=>{let r=rt.checked?"on":"off";lt(Qr,r),document.body.setAttribute("apge_dark",r),ye.textContent=rt.checked?"On":"Off";let t="animate-color-and-background-color";document.body.classList.add(t),be.classList.add(t),setTimeout(()=>{document.body.classList.remove(t),be.classList.remove(t)},500)});document.addEventListener("keydown",r=>{if(!(hr()||r.isComposing))switch(r.code){case"Enter":{m.toggle();break}case"Space":{v.disabled||(r.preventDefault(),m.doStep());break}}});T.addEventListener("drop",async r=>{r.preventDefault();let t=r.dataTransfer?.files.item(0);t!=null&&(m.setInputAndReset(await t.text()),T.scrollTop=0)});Yt.disabled=!1;xr.disabled=!1;m.initializeApp();dt(()=>{let r="initial_code",t=localStorage.getItem(r);t!==null&&t!==""&&(localStorage.removeItem(r),m.setInputAndReset(t))});dt(()=>{localStorage.getItem(ne)===null&&lt(ne,"true");let r=[{key:Jr,checkbox:bt},{key:Xr,checkbox:E.$reverseBinary},{key:Wr,checkbox:E.$hideBinary},{key:ne,checkbox:E.$showBinaryValueInDecimal},{key:Kr,checkbox:E.$showBinaryValueInHex}];for(let{key:t,checkbox:e}of r)localStorage.getItem(t)==="true"&&(e.checked=!0);localStorage.getItem(Qr)==="on"&&(document.body.setAttribute("apge_dark","on"),rt.checked=!0,ye.textContent="On"),m.render()});dt(()=>{dr()||ge.forEach(t=>{let e=t.dataset[Pr];e!==void 0&&lr(jr+e)})});"serviceWorker"in navigator&&dt(async()=>{navigator.serviceWorker.getRegistrations().then(r=>{for(let t of r)t.unregister()})});var xc=null;export{xc as _index};
