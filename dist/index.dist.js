var Ie=Object.defineProperty;var Be=(t,e)=>{for(var r in e)Ie(t,r,{get:e[r],enumerable:!0})};var o=(t,e)=>{let r=document.querySelector(t);if(r==null)throw Error(`can't found a element for "${t}"`);if(r instanceof e)return r;throw Error(`"${t}" is not a ${e.name}`)};function l(t,e=void 0){let r=document.createElement(t);if(typeof e=="string")r.textContent=e;else if(e!=null&&typeof e=="object"&&(e.text&&(r.textContent=e.text),e.classes&&r.classList.add(...e.classes),e.fn&&(e.fn(r),e.fn=void 0),e.children&&r.append(...e.children),e.style))for(let[s,n]of Object.entries(e.style))s in r.style?r.style[s]=n:r.style.setProperty(s,n);return r}var j=class{#r=0;#n=-1;#t=!1;#i=0;#s=0;constructor(e,{frequency:r,signal:s}){this.#i=r;let n=requestAnimationFrame,i=c=>{if(this.#t&&this.#n!==-1){let d=c-this.#n,u=this.#r,a=u+d/1e3*this.#i,p=Math.floor(a)-Math.floor(u);this.#r=a,e(p)}this.#n=c,this.#s=n(i)};this.#s=n(i),s?.addEventListener("abort",()=>{this.abort()})}abort(){this.#s!==0&&cancelAnimationFrame(this.#s)}get frequency(){return this.#i}set frequency(e){this.#i=e}get disabled(){return!this.#t}set disabled(e){this.#t=!e}reset(){this.#r=0}};var bt=t=>t instanceof Error?t.message:"Unknown error is occurred.";function*Ht(t,e){if(!Number.isInteger(e))throw RangeError("size is not an integer");let r=[];for(let s of t)r.push(s),e<=r.length&&(yield r,r=[]);r.length!==0&&(yield r)}var Ft=()=>{let t=document.createElement("span");return t.classList.add("spinner-border","spinner-border-sm"),t.setAttribute("role","status"),t.setAttribute("aria-hidden","true"),t};var x=()=>{throw Error("internal error")};var zt=(t,e,r,s)=>{let n=t.canvas.width,i=t.canvas.height;n!==i&&(t.canvas.height=n),t.reset?t.reset():(t.clearRect(0,0,n,n),t.resetTransform(),t.beginPath());let c=e.maxX,d=e.maxY,u=Math.max(c,d)+1,a=n/u;s||(t.scale(1,-1),t.translate(0,-n));let p=e.data;t.fillStyle="#212529";for(let f=0;f<=d;f++){let m=p[f]??x(),b=f*a;for(let C=0;C<=c;C++)m[C]===1&&t.rect(C*a,b,a,a)}t.fill(),r||(t.strokeStyle="#03A9F4",t.lineWidth=4,t.strokeRect(e.x*a,e.y*a,a,a))};var Re=t=>{if(window.innerWidth<768)return t===9?t:8;let r=12;return r+1<=t&&t<=r+2?t:r},Ae=t=>l("th",{text:`U${t}`,classes:["text-end"]}),De=(t,e)=>l("td",{text:e.toString(),fn:r=>{r.dataset.test=`U${t}`},classes:["text-end"]}),He=t=>{let e=[],r=[],s=Re(t.size);for(let i of Ht(t,s)){let c=l("tr"),d=l("tr");for(let[u,a]of i){c.append(Ae(u));let p=De(u,a);e.push(p),d.append(p)}r.push({header:c,data:d})}let n=l("table");for(let i of r)n.append(i.header,i.data);return n.classList.add("table"),n.style.tableLayout="fixed",n.style.marginBottom="0",{table:n,cells:e}},Y=class{constructor(e){this.root=e,this.cells=[]}initialize(e){let{table:r,cells:s}=He(e);this.root.replaceChildren(r),this.cells=s}clear(){this.cells=[],this.root.innerHTML=""}render(e){let r=0,s=this.cells;for(let n of e.values()){let i=s[r]??x();i.textContent=n.toString(),r++}}};var K=t=>{let e="";for(let r=t.length-1;r>=0;r--)e+=t[r]===0?"0":"1";return e},xt=t=>{let e="",r=t.length;for(let s=0;s<r;s++)e+=t[s]===0?"0":"1";return e},Fe=typeof BigInt<"u";function wt(t,e){return(Fe?BigInt:Number)("0b"+K(t)).toString(e)}var ze=()=>{let t=l("span",{classes:["decimal"]}),e=l("span",{classes:["hex"]}),r=l("span",{classes:["max_pointer"]}),s=l("span",{classes:["pointer"]});return{metaData:l("code",{classes:["binary_info","word-break-all"],children:[t,e,r,s]}),$decimal:t,$hex:e,$maxPointer:r,$pointer:s}},Ne=()=>{let t=l("span",{classes:["prefix"]}),e=l("span",{classes:["binary-head"]}),r=l("span",{classes:["suffix"]});return{binaryBits:l("code",{classes:["word-break-all"],children:[t,e,r]}),$prefix:t,$head:e,$suffix:r}},G=class{constructor(e){this.root=e,this.cells=[]}initialize(e){this.clear();let r=[],s=l("table");for(let n of e.keys()){let i=l("td");i.dataset.test=`B${n}`;let{metaData:c,$decimal:d,$hex:u,$maxPointer:a,$pointer:p}=ze();i.append(c,l("br"));let{binaryBits:f,$prefix:m,$head:b,$suffix:C}=Ne();i.append(f);let gt=l("tr",{children:[l("th",`B${n}`),i]});s.append(gt),r.push({$decimal:d,$hex:u,$maxPointer:a,$pointer:p,$prefix:m,$head:b,$suffix:C})}this.root.append(s),this.cells=r}clear(){this.cells=[],this.root.innerHTML=""}render(e,r,s,n,i){let c=0,d=this.cells;for(let u of e.values()){let{$prefix:a,$head:p,$suffix:f,$decimal:m,$hex:b,$maxPointer:C,$pointer:gt}=d[c]??x();if(r)a.innerHTML="",p.innerHTML="",f.innerHTML="";else{let D=Pe(u);a.textContent=s?K(D.suffix):xt(D.prefix),p.textContent=D.head.toString(),f.textContent=s?K(D.prefix):xt(D.suffix)}n?m.textContent="value = "+wt(u.bits,10)+", ":m.innerHTML="",i?b.textContent="hex = "+wt(u.bits,16)+", ":b.innerHTML="",C.textContent="max_pointer = "+(u.bits.length-1)+", ",gt.textContent="pointer = "+u.pointer.toString(),c++}}};function Pe(t){let e=t.bits,r=t.pointer;return{prefix:e.slice(0,r),head:e[r]??x(),suffix:e.slice(r+1)}}var w=t=>t.toLocaleString();var Nt="stats_current_state",Ue=(t,{z:e,nz:r})=>{let s=l("td",{fn:a=>{a.colSpan=2},children:[l("code",t)]}),n="num",i=l("td",{text:w(e+r),classes:[n]}),c=l("td",{text:w(e),classes:[n]}),d=l("td",{text:w(r),classes:[n]});return{$tr:l("tr",{children:[s,i,c,d]}),$sum:i,$z:c,$nz:d}},X=class{#r;constructor(e,r){this.root=e,this.#r=r,this.cells=[]}initialize(e,r){this.#r.textContent=w(r.length),this.cells=[],this.root.innerHTML="";for(let[s,n]of e.entries()){let i=r[s]??"",{$tr:c,$sum:d,$z:u,$nz:a}=Ue(i,n);this.root.append(c),this.cells.push({$sum:d,$z:u,$nz:a,$tr:c})}}clear(){this.#r.innerHTML="",this.cells=[],this.root.innerHTML=""}render(e,r){let s=e,n=this.cells,i=n.length;for(let c=0;c<i;c++){let d=n[c]??x();r===c?d.$tr.classList.add(Nt):d.$tr.classList.remove(Nt);let{z:u,nz:a}=s[c]??x();d.$sum.textContent=w(u+a),d.$z.textContent=w(u),d.$nz.textContent=w(a)}}};function Pt(t,e){if(t.innerHTML="",e===void 0)return;let r=l("option","None");r.value="-1",r.selected=!0,t.append(r);for(let[s,n]of e){let i=l("option",s);i.value=n.toString(),t.append(i)}}function Ut(t){switch(t.value){case"*":return-1;case"Z":return 0;default:return 1}}var Ve="Start",qe="Stop",Vt="btn-primary",qt="btn-danger",Wt=t=>`<svg width="16" height="16" viewBox="0 0 16 16">${t}</svg>`,We=()=>{let t=l("div");return t.innerHTML=Wt('<path stroke="currentColor" stroke-width="1" d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>')+Ve,t},Oe=We(),je=()=>{let t=l("div");return t.innerHTML=Wt('<path stroke="currentColor" stroke-width="1" d="M3.5 5A1.5 1.5 0 0 1 5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5zM5 4.5a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5V5a.5.5 0 0 0-.5-.5H5z"/>')+qe,t},Ye=je();function H(t){t.disabled=!1,t.replaceChildren(Oe),t.classList.add(Vt),t.classList.remove(qt)}function Ot(t){t.disabled=!1,t.replaceChildren(Ye),t.classList.remove(Vt),t.classList.add(qt)}function jt(t,e,r){if(t.replaceChildren(),e==="RuntimeError"||e==="ParseError"){let s=r.split(`
`);for(let n of s)t.append(l("span","- "+n),l("br"));t.classList.remove("d-none")}else t.classList.add("d-none")}var F=40,Q=window.innerWidth;Q>=1200?F=120:Q>=992?F=100:Q>=768?F=70:Q>=576&&(F=50);var Yt=(t,e)=>{if(e=e??"",t.value===e)return;t.value=e;let r=e.length,n=Math.min(6,Math.max(1,Math.ceil(r/F)));t.rows=n};var Ke=()=>{let t=[];for(let r=0;r<=6;r++)for(let s of[1,...r===0?[]:[1.5],2,3,5,8])t.push(s*10**r);return t.push(10*10**6,15*10**6,20*10**6,100*10**6),t.map(r=>Math.floor(r))};function Kt(t,e){let r=Ke();t.min="0",t.max=(r.length-1).toString();function s(){console.log(t.value);let n=parseInt(t.value,10),i=r[n]??x();t.ariaValueText=`(${i.toString()}Hz)`,e.setFrequency(i)}t.addEventListener("input",()=>{s()}),setTimeout(()=>{s()},1)}var Gt=(t,e)=>{t.setCustomValidity(e),t.reportValidity(),t.classList.add("is-invalid")},Xt=t=>{t.setCustomValidity(""),t.reportValidity(),t.classList.remove("is-invalid")};function Qt(t,e){t.addEventListener("input",()=>{let r=t.files?.item(0);r?.text().then(e)})}var Z=window.requestIdleCallback??(t=>{setTimeout(()=>{t({didTimeout:!1,timeRemaining(){return 0}})},0)});function M(t,e){try{localStorage.setItem(t,e)}catch{}}function J(t){try{localStorage.removeItem(t)}catch{}}function T(t){try{return localStorage.getItem(t)}catch{return null}}function I(t,e){try{let r=T(t);r!=null&&(J(t),M(e,r))}catch{}}var Ge=new Set(["textarea","input","summary","details","button","audio","video","select","option","a","area","modal"]),Zt=()=>{let t=document.activeElement?.tagName.toLowerCase()??"";return Ge.has(t)};var h=HTMLElement,S=HTMLInputElement,v=HTMLButtonElement,Jt=o("#error",h),_=o("#input",HTMLTextAreaElement),te=o("#output_detail",h),ee=o("#output",HTMLTextAreaElement),re=o("#steps",h),$=o("#toggle",v),k=o("#reset",v),E=o("#step",v),tt=o("#step-text",h),ne=o("#config_button",v),B=o("#stats_button",v),se=o("#current_state",h),ie=o("#previous_output",h),oe=o("#frequency_input",S),ae=o("#frequency_output",h),ce=o("#command",h),et=o("#canvas",HTMLCanvasElement),rt=et.getContext("2d")??(()=>{throw Error("context is null")})(),z={x:o("#b2dx",h),y:o("#b2dy",h)},R=o("#b2d_detail",HTMLDetailsElement),le=o("#unary_register",h),N=o("#unary_register_detail",HTMLDetailsElement),de=o("#binary_register",h),P=o("#binary_register_detail",HTMLDetailsElement),ue=o("#add_sub_mul_detail",h),pe=o("#add_sub_mul",h),fe=o("#import_file",S),nt=o("#examples",v),me=document.querySelectorAll(".js_example"),$t=o("#config_modal_content",h),U=o("#step_input",S),g={$hideBits:o("#hide_bits",S),$reverseBits:o("#reverse_bits",S),$showBinaryValueInDecimal:o("#show_binary_value_in_decimal",S),$showBinaryValueInHex:o("#show_binary_value_in_hex",S)},Et=o("#breakpoint_select",HTMLSelectElement),he=o("#breakpoint_input_select",HTMLSelectElement),V=o("#dark_mode",S),St=o("#dark_mode_label",h),st=o("#b2d_hide_pointer",S),q=o("#b2d_flip_upside_down",S),it=o("#stats_modal",h),ye=o("#stats_body",h),ge=o("#stats_number_of_states",h),be=o("#view-state-diagram",v),xe=o("#add-library-file",v),we=o("#library-list",h),_t=o('#library_modal [data-bs-dismiss="modal"]',h),ot=o("#add-binary-library-file",v);function Xe(t,e){let r=document.createElement("input");r.type="file",r.style.display="none",t.addEventListener("click",()=>{r.click()}),r.addEventListener("change",s=>{let n=s.target.files;if(n.length>0){let i=n[0];e(i)}}),document.body.appendChild(r)}var at=class{constructor(){this.files=[]}getFiles(){return this.files.slice()}initialize(){ot.addEventListener("click",async()=>{ot.disabled=!0,this.addFile({name:"binary.apglib",content:await fetch("./frontend/data/binary.apglib").then(e=>e.text()),builtin:!0}),await new Promise(e=>setTimeout(e,500)),_t.click()}),Xe(xe,async e=>{this.addFile({name:e.name,content:await e.text()}),await new Promise(r=>setTimeout(r,500)),_t.click()})}addFile(e){this.files.push(e);let r=l("td");r.textContent=e.name;let s=l("button",{text:"Delete"});s.className="btn btn-danger btn-sm",s.addEventListener("click",()=>{e.builtin&&(ot.disabled=!1),this.files=this.files.filter(c=>c.name!==e.name),i.remove()});let n=l("td",{children:[s]}),i=l("tr",{children:[r,n]});we.append(i)}};var mt={};Be(mt,{createEndpoint:()=>Ee,expose:()=>Lt,finalizer:()=>lt,proxy:()=>Te,proxyMarker:()=>kt,releaseProxy:()=>Se,transfer:()=>Me,transferHandlers:()=>Ct,windowEndpoint:()=>sr,wrap:()=>ke});var kt=Symbol("Comlink.proxy"),Ee=Symbol("Comlink.endpoint"),Se=Symbol("Comlink.releaseProxy"),lt=Symbol("Comlink.finalizer"),dt=Symbol("Comlink.thrown"),_e=t=>typeof t=="object"&&t!==null||typeof t=="function",Qe={canHandle:t=>_e(t)&&t[kt],serialize(t){let{port1:e,port2:r}=new MessageChannel;return Lt(t,e),[r,[r]]},deserialize(t){return t.start(),ke(t)}},Ze={canHandle:t=>_e(t)&&dt in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},Ct=new Map([["proxy",Qe],["throw",Ze]]);function Je(t,e){for(let r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function Lt(t,e=globalThis,r=["*"]){e.addEventListener("message",function s(n){if(!n||!n.data)return;if(!Je(r,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}let{id:i,type:c,path:d}=Object.assign({path:[]},n.data),u=(n.data.argumentList||[]).map(L),a;try{let p=d.slice(0,-1).reduce((m,b)=>m[b],t),f=d.reduce((m,b)=>m[b],t);switch(c){case"GET":a=f;break;case"SET":p[d.slice(-1)[0]]=L(n.data.value),a=!0;break;case"APPLY":a=f.apply(p,u);break;case"CONSTRUCT":{let m=new f(...u);a=Te(m)}break;case"ENDPOINT":{let{port1:m,port2:b}=new MessageChannel;Lt(t,b),a=Me(m,[m])}break;case"RELEASE":a=void 0;break;default:return}}catch(p){a={value:p,[dt]:0}}Promise.resolve(a).catch(p=>({value:p,[dt]:0})).then(p=>{let[f,m]=ft(p);e.postMessage(Object.assign(Object.assign({},f),{id:i}),m),c==="RELEASE"&&(e.removeEventListener("message",s),ve(e),lt in t&&typeof t[lt]=="function"&&t[lt]())}).catch(p=>{let[f,m]=ft({value:new TypeError("Unserializable return value"),[dt]:0});e.postMessage(Object.assign(Object.assign({},f),{id:i}),m)})}),e.start&&e.start()}function tr(t){return t.constructor.name==="MessagePort"}function ve(t){tr(t)&&t.close()}function ke(t,e){let r=new Map;return t.addEventListener("message",function(n){let{data:i}=n;if(!i||!i.id)return;let c=r.get(i.id);if(c)try{c(i)}finally{r.delete(i.id)}}),vt(t,r,[],e)}function ct(t){if(t)throw new Error("Proxy has been released and is not useable")}function Ce(t){return A(t,new Map,{type:"RELEASE"}).then(()=>{ve(t)})}var ut=new WeakMap,pt="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{let e=(ut.get(t)||0)-1;ut.set(t,e),e===0&&Ce(t)});function er(t,e){let r=(ut.get(e)||0)+1;ut.set(e,r),pt&&pt.register(t,e,t)}function rr(t){pt&&pt.unregister(t)}function vt(t,e,r=[],s=function(){}){let n=!1,i=new Proxy(s,{get(c,d){if(ct(n),d===Se)return()=>{rr(i),Ce(t),e.clear(),n=!0};if(d==="then"){if(r.length===0)return{then:()=>i};let u=A(t,e,{type:"GET",path:r.map(a=>a.toString())}).then(L);return u.then.bind(u)}return vt(t,e,[...r,d])},set(c,d,u){ct(n);let[a,p]=ft(u);return A(t,e,{type:"SET",path:[...r,d].map(f=>f.toString()),value:a},p).then(L)},apply(c,d,u){ct(n);let a=r[r.length-1];if(a===Ee)return A(t,e,{type:"ENDPOINT"}).then(L);if(a==="bind")return vt(t,e,r.slice(0,-1));let[p,f]=$e(u);return A(t,e,{type:"APPLY",path:r.map(m=>m.toString()),argumentList:p},f).then(L)},construct(c,d){ct(n);let[u,a]=$e(d);return A(t,e,{type:"CONSTRUCT",path:r.map(p=>p.toString()),argumentList:u},a).then(L)}});return er(i,t),i}function nr(t){return Array.prototype.concat.apply([],t)}function $e(t){let e=t.map(ft);return[e.map(r=>r[0]),nr(e.map(r=>r[1]))]}var Le=new WeakMap;function Me(t,e){return Le.set(t,e),t}function Te(t){return Object.assign(t,{[kt]:!0})}function sr(t,e=globalThis,r="*"){return{postMessage:(s,n)=>t.postMessage(s,r,n),addEventListener:e.addEventListener.bind(e),removeEventListener:e.removeEventListener.bind(e)}}function ft(t){for(let[e,r]of Ct)if(r.canHandle(t)){let[s,n]=r.serialize(t);return[{type:"HANDLER",name:e,value:s},n]}return[{type:"RAW",value:t},Le.get(t)||[]]}function L(t){switch(t.type){case"HANDLER":return Ct.get(t.name).deserialize(t.value);case"RAW":return t.value}}function A(t,e,r,s){return new Promise(n=>{let i=ir();e.set(i,n),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),s)})}function ir(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var or=30,ht=class{#r;#n="";#t;#i;#s=new Y(le);#c=new G(de);#a=new X(ye,ge);$libraryUI=new at;#o;#e="Initial";constructor(){this.stepConfig=1,this.#o=new j(e=>{this.run(e)},{frequency:or}),this.$libraryUI.initialize()}setFrequency(e){this.#o.frequency=e,this.#l()}async start(){switch(this.#e){case"Initial":{await this.reset()&&(this.#e="Running");break}case"Stop":{this.#e="Running";break}default:throw Error("start: unreachable")}await this.render()}async stop(){this.#e="Stop",await this.render()}async toggle(){this.#e==="Running"?this.stop():await this.start()}async#d(){this.#t===void 0?this.#s.clear():this.#s.initialize(await this.#t.getURegMap())}async#u(){this.#t===void 0?this.#c.clear():this.#c.initialize(await this.#t.getBRegMap())}async#p(){await this.#d(),await this.#u(),await this.#h(),Pt(Et,await this.#t?.getStateMap())}doStep(){if(this.#e==="Running"&&this.stop(),this.stepConfig>=5e6){let e=Ft();e.style.position="absolute",E.append(e),tt.style.color="transparent",E.disabled=!0,k.disabled=!0,$.disabled=!0,setTimeout(()=>{try{this.run(this.stepConfig)}finally{tt.style.color="",e.remove()}},33)}else this.run(this.stepConfig)}setInputAndReset(e){_.value=e,this.reset()}async reset(){if(this.#n="",this.#t)try{await this.#t.terminate()}catch(e){console.error(e)}this.#t=void 0,this.#o.reset();try{let e=this.$libraryUI.getFiles();this.#t=mt.wrap(new Worker("./dist/machine-worker.js",{type:"module"})),await this.#t?.init(_.value,e),await this.#p(),this.#e="Stop"}catch(e){return this.#e="ParseError",this.#n=bt(e),await this.render(),!1}return this.render(),!0}#l(){let e=this.#o.frequency;this.#i!==e&&(ae.textContent=w(e),this.#i=e)}async#f(){try{ce.textContent=await this.#t?.getNextCommandText()??""}catch(e){console.error(e)}}async renderB2D(){if(!R.open)return;let e=this.#t;if(e===void 0){z.x.textContent="0",z.y.textContent="0",rt.clearRect(0,0,et.width,et.height),rt.resetTransform();return}let r=await e.getB2D();z.x.textContent=r.x.toString(),z.y.textContent=r.y.toString();let s=performance.now();zt(rt,r,st.checked,q.checked),this.#e==="Running"&&performance.now()-s>=200&&(R.open=!1)}async renderUnary(){this.#t!==void 0&&N.open&&this.#s.render(await this.#t.getURegMap())}async renderBinary(){this.#t!==void 0&&P.open&&this.#c.render(await this.#t.getBRegMap(),g.$hideBits.checked,g.$reverseBits.checked,g.$showBinaryValueInDecimal.checked,g.$showBinaryValueInHex.checked)}async#m(){let e=await this.#t?.getOutput();Yt(ee,e)}async#h(){this.#t===void 0?this.#a.clear():this.#a.initialize(await this.#t.getStateStats(),await this.#t.getStates())}async renderStats(){if(!it.classList.contains("show"))return;let e=this.#t;if(e===void 0){this.#a.clear();return}this.#a.render(await e.getStateStats(),await e.getCurrentStateIndex())}#y(){switch(this.#e){case"Initial":{H($),E.disabled=!1,k.disabled=!1,B.disabled=!0;break}case"Stop":{H($),E.disabled=!1,k.disabled=!1,B.disabled=!1;break}case"Running":{Ot($),E.disabled=!0,k.disabled=!0,B.disabled=!1;break}case"RuntimeError":case"ParseError":{H($),$.disabled=!0,E.disabled=!0,k.disabled=!1,B.disabled=!0;break}case"Halted":{H($),$.disabled=!0,E.disabled=!0,k.disabled=!1,B.disabled=!1;break}}}async render(){let e=this.#t,r=this.#e;if(this.#o.disabled=r!=="Running",this.#r!==r||r==="Stop"){this.#y(),r==="ParseError"?_.classList.add("is-invalid"):_.classList.remove("is-invalid");let i=await e?.getAnalyzeResult();N.style.display=i==null||i.unary.length===0?"none":"",P.style.display=i==null||i.binary.length===0?"none":"",ue.style.display=i?.hasAdd||i?.hasSub||i?.hasMul?"":"none",R.style.display=i?.hasB2D?"":"none",te.style.display=i?.hasOutput?"":"none"}jt(Jt,r,this.#n),this.#l();let s=await e?.getInfo();se.textContent=s?.currentState??"",ie.textContent=s?.previousOutput??"",re.textContent=s?.stepCount.toLocaleString()??"";let n=this.stepConfig;tt.textContent=n===1?"Step":`${w(n)} Steps`,await this.#f(),await this.#m(),await this.renderUnary(),await this.renderBinary(),pe.textContent=await e?.getAddSubMulToUIString()??"",await this.renderB2D(),await this.renderStats(),this.#r=r}async run(e){switch(this.#e){case"Initial":if(!this.reset())return}if(e<=0||isNaN(e))return;let r=this.#t;if(r===void 0)return;let s=this.#e==="Running",n=parseInt(Et.value,10),i=Ut(he);try{let c=await r.exec(e,s,n,i);c!==void 0&&(this.#e=c)}catch(c){this.#e="RuntimeError",this.#n=bt(c)}finally{await this.render()}}};var ar="./frontend/data/",y=new ht;k.addEventListener("click",()=>{y.reset()});$.addEventListener("click",()=>{y.toggle()});E.addEventListener("click",()=>{y.doStep()});me.forEach(t=>{t.addEventListener("click",async()=>{nt.style.opacity="0.5";let e=t.dataset.src;try{let r=await fetch(ar+e);if(!r.ok)throw Error("error");y.setInputAndReset(await r.text()),Dt()}catch(r){throw r}finally{nt.removeAttribute("style")}})});Kt(oe,y);R.addEventListener("toggle",()=>{y.renderB2D()});P.addEventListener("toggle",()=>{y.renderBinary()});N.addEventListener("toggle",()=>{y.renderUnary()});var Dt=()=>{_.scrollTop=0};Qt(fe,t=>{y.setInputAndReset(t),Dt()});U.addEventListener("input",()=>{let t=Number(U.value);isNaN(t)||t<=0||!Number.isInteger(t)?(Gt(U,"Enter a positive integer"),y.stepConfig=1):(Xt(U),y.stepConfig=t),y.render()});var O=(t,e)=>{t.addEventListener("change",()=>{y.render(),M(e,t.checked.toString())})},Mt="apge_hide_binary";O(g.$hideBits,Mt);var Tt="apge_reverse_binary";O(g.$reverseBits,Tt);var W="apge_show_binary_in_decimal";O(g.$showBinaryValueInDecimal,W);var It="apge_show_binary_in_hex";O(g.$showBinaryValueInHex,It);st.addEventListener("change",()=>{y.renderB2D()});var Bt="apge_b2d_flip_upside_down";O(q,Bt);it.addEventListener("shown.bs.modal",()=>{y.renderStats()});be.addEventListener("click",()=>{_.value.length>=10**6||(M("state-diagram-input",_.value),window.open("./tools/diagram/index.html",void 0,"noreferrer=yes,noopener=yes"))});var Rt="apge_dark",yt="on",At="dark_mode";V.addEventListener("change",()=>{V.checked?(M(At,yt),document.body.setAttribute(Rt,yt)):(J(At),document.body.removeAttribute(Rt)),St.textContent=V.checked?"On":"Off";let t="dark-mode-anim";document.body.classList.add(t),$t.classList.add(t),setTimeout(()=>{document.body.classList.remove(t),$t.classList.remove(t)},500)});document.addEventListener("keydown",t=>{if(!(Zt()||t.isComposing||t.metaKey||t.shiftKey||t.ctrlKey))switch(t.code){case"Enter":{y.toggle();break}case"Space":{E.disabled||(t.preventDefault(),y.doStep());break}}});_.addEventListener("drop",async t=>{t.preventDefault();let e=t.dataTransfer?.files.item(0);e!=null&&(y.setInputAndReset(await e.text()),Dt())});nt.disabled=!1;ne.disabled=!1;y.render();Z(()=>{let t="initial_code",e=T(t);e!==null&&(J(t),y.setInputAndReset(e))});Z(()=>{I("hide_binary",Mt),I("show_binary_in_decimal",W),I("reverse_binary",Tt),I("b2d_flip_upside_down",Bt),I("show_binary_in_hex",It),T(W)===null&&M(W,"true");let t=[{key:Bt,checkbox:q},{key:Tt,checkbox:g.$reverseBits},{key:Mt,checkbox:g.$hideBits},{key:W,checkbox:g.$showBinaryValueInDecimal},{key:It,checkbox:g.$showBinaryValueInHex}];for(let{key:e,checkbox:r}of t)T(e)==="true"&&(r.checked=!0);T(At)===yt&&(document.body.setAttribute(Rt,yt),V.checked=!0,St.textContent="On"),y.render()});"serviceWorker"in navigator&&Z(async()=>{(await navigator.serviceWorker.getRegistrations()).map(e=>e.unregister())});
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
